<html>
    <head>
        <title> After School Lessons </title>
        <script src = "https://unpkg.com/vue"></script>
        <script src = "lessons.js"></script>
    </head>
    <body>
        <div id ="app">
            <header>
                <!--<h1 v-text = "sitename"> </h1> -->
                <button v-on:click = "showCheckoutPage" v-if="itemsInCart">
                    {{ cartItemCount }} Checkout
                </button>
                <button disabled="disabled" v-else>
                    Checkout
                </button>
            </header>
            <main>
                <div v-if = "showProductPage">
                    <div v-for="lesson in lesson">
                    <figure>
                        <img v-bind:src = "lesson.image" style = "height: 250px; width: 250px">
                    </figure>
                    <h2 v-text = "lesson.subject"></h2>
                    <p v-html = "lesson.location"></p>
                    <p> Price : {{lesson.price}} AED </p>
                    <p> Spaces : {{lesson.availableSpaces - cartCount(lesson.id)}} </p>
                    <!-- Add to cart button when items can be added -->
                    <button v-on:click = "addToCart(lesson)" v-if="canAddToCart(lesson)"> 
                        Add to Cart 
                    </button>
                    <!-- Add to cart button will be disabled when the items cannot be added-->
                    <button disabled = "disabled" v-else> 
                        Add to Cart 
                    </button>
                </div> <!-- end of v-for -->
                </div><!-- end of v-if-->
                <div v-else>
                    <h2> Shopping Cart </h2>
                    <h2> Checkout </h2>
                    <p>
                        <strong> First name: </strong> 
                        <input v-model="order.firstName" required/>
                    </p>
                    <p>
                        <strong> Last name: </strong> 
                        <input v-model="order.lastName" required/>
                    </p>
                    <p>
                        <strong> Phone: </strong> 
                        <input v-model.number="order.phoneNum" type = "number" required/>
                    </p>
                    <h4> Order Information</h4>
                    
                    <p> First Name : {{ order.firstName}}</p>
                    <p> Last Name : {{ order.lastName }} </p>
                    <p> Phone : {{ order.phoneNum }} </p>
                    <button v-on:click="showThankYou" v-if="canConfirmOrder"> 
                        Confirm Order 
                    </button>
                    <button disabled = "disabled" v-else>
                        Confirm Order
                    </button>
                </div>
            </main>    
        </div>

        <script type = "text/javascript">
            var school = new Vue ({
                el: "#app",
                data: {
                    lesson: lessons,
                    cart: [],  //the array that holds the items added to cart.
                    showProductPage : true,
                    order:
                    {
                        firstName: "",
                        lastName: "",
                        phoneNum: ""
                    }
                },
                methods:{
                    addToCart(lesson)
                    {
                        this.cart.push(lesson.id);
                    },
                    showCheckoutPage()
                    {
                        this.showProductPage = this.showProductPage ? false : true;
                    },
                    showThankYou()
                    {
                        alert("Thank you");
                    },
                    canAddToCart(lesson)
                    {
                        return lesson.availableSpaces > this.cartCount(lesson.id);
                    },
                    cartCount(id)
                    {
                        let count = 0;
                        for(let i = 0; i < this.cart.length; i++)
                        {
                            if(this.cart[i] === id)
                            {
                                count++;
                            }   
                        }
                        return count;
                    }
                },
                computed:{
                    cartItemCount: function()
                    {
                        return this.cart.length;
                    },
                    itemsInCart()  //checks if the items are present or not
                    {
                        return this.cartItemCount > 0;
                    },
                    canConfirmOrder()  
                    {  
                        let alphabets = /^[A-Za-z]+$/;
                        let num_range = /^[0-9]+$/;
                        return alphabets.test(this.order.firstName) && alphabets.test(this.order.lastName) && num_range.test(this.order.phoneNum);
                    } 
                },
            });
        </script>
    </body>
</html>