<html>
    <head>
        <title> After School Lessons </title>
        <script src = "https://unpkg.com/vue"></script>
        <script src = "lessons.js"></script>
    </head>
    <body>
        <div id ="app">
            <header>
                <!--<h1 v-text = "sitename"> </h1> -->
                <button v-on:click = "showCheckoutPage" v-if="itemsInCart">
                    {{ cartItemCount }} Checkout
                </button>
                <button disabled="disabled" v-else>
                    Checkout
                </button>
                <p> 
                    <input type = "radio" id = "price" value = "Price" v-model = "attribute"> 
                    <label for = "price"> Price </label>
                    <input type = "radio" id="subject" value = "Subject" v-model="attribute">
                    <label for = "business"> Subject </label>
                    <input type = "radio" id = "location" value = "Location" v-model = "attribute">
                    <label for = "location"> Location </label>
                    <input type = "radio" id = "spaces" value = "Spaces" v-model = "attribute">
                    <label for = "spaces"> Available Spaces </label>
                </p>
                <button v-on:click="sortAscending"> Ascending </button>
                <button v-on:click="sortDescending"> Descending </button> 
            </header>
            <main>
                <div v-if = "showProductPage">
                    <div v-for="lesson in lesson">
                    <figure>
                        <img v-bind:src = "lesson.image" style = "height: 250px; width: 250px">
                    </figure>
                    <h2 v-text = "lesson.subject"></h2>
                    <p v-html = "lesson.location"></p>
                    <p> Price : {{lesson.price}} AED </p>
                    <p> Spaces : {{lesson.availableSpaces}} </p>
                    <!-- Add to cart button when items can be added -->
                    <button v-on:click = "addToCart(lesson)" v-if="canAddToCart(lesson)"> 
                        Add to Cart 
                    </button>
                    <!-- Add to cart button will be disabled when the items cannot be added-->
                    <button disabled = "disabled" v-else> 
                        Add to Cart 
                    </button>
                </div> <!-- end of v-for -->
                </div><!-- end of v-if-->
                <div v-else>
                    <h2> Shopping Cart </h2>
                    <h2> Checkout </h2>
                    <p>
                        <strong> First name: </strong> 
                        <input v-model="order.firstName" required/>
                    </p>
                    <p>
                        <strong> Last name: </strong> 
                        <input v-model="order.lastName" required/>
                    </p>
                    <p>
                        <strong> Phone: </strong> 
                        <input v-model.number="order.phoneNum" type = "number" required/>
                    </p>
                    <h4> Order Information</h4>
                    
                    <p> First Name : {{ order.firstName}}</p>
                    <p> Last Name : {{ order.lastName }} </p>
                    <p> Phone : {{ order.phoneNum }} </p>
                    <button v-on:click="showThankYou" v-if="canConfirmOrder"> 
                        Confirm Order 
                    </button>
                    <button disabled = "disabled" v-else>
                        Confirm Order
                    </button>
                </div>
            </main>    
        </div>

        <script type = "text/javascript">
            var school = new Vue ({
                el: "#app",
                data: {
                    lesson: lessons,
                    cart: [],  //the array that holds the items added to cart.
                    showProductPage : true,
                    attribute: '',
                    order:
                    {
                        firstName: "",
                        lastName: "",
                        phoneNum: ""
                    }
                },
                methods:{
                    addToCart(lesson)
                    {
                        this.cart.push(lesson.id);
                        lesson.availableSpaces--;
                    },
                    showCheckoutPage()
                    {
                        this.showProductPage = this.showProductPage ? false : true;
                    },
                    showThankYou()
                    {
                        alert("Thank you");
                    },
                    //
                    canAddToCart(lesson)
                    {
                        return lesson.availableSpaces > 0;
                    },
                    cartCount(id)
                    {
                        let count = 0;
                        for(let i = 0; i < this.cart.length; i++)
                        {
                            if(this.cart[i] === id)
                            {
                                count++;
                            }   
                        }
                        return count;
                    },
                    sortAscending()
					{
						if(this.attribute === "Price")
						{
							function ascendPrice(a,b)
							{
							if(a.price > b.price)
								return 1;
							if(a.price < b.price)
							    return -1;
							return 0
							}
							this.lesson.sort(ascendPrice);
						}
						else if(this.attribute === "Subject")
						{
							function ascendSubject(a,b)
							{
							if(a.subject > b.subject)
								return 1;
							if(a.subject < b.subject)
							    return -1;
							return 0
							}
							this.lesson.sort(ascendSubject);
						}
						else if(this.attribute === "Location")
						{
							function ascendLocation(a,b)
							{
							if(a.location > b.location)
								return 1;
							if(a.location < b.location)
							    return -1;
							return 0
							}
							this.lesson.sort(ascendLocation);
						}
						else if(this.attribute === "Spaces")
						{
							//let spaces = this.lesson.availableSpaces 
							function ascendSpaces(a,b)
							{
							if(a.availableSpaces > b.availableSpaces)
								return 1;
							if(a.availableSpaces < b.availableSpaces)
							    return -1;
							return 0
							}
							this.lesson.sort(ascendSpaces);
						}
						else
						{
							alert("Please choose an attribute");
                        }
                    },
                    sortDescending()
					{
						if(this.attribute === "Price")
						{
							function descendPrice(a,b)
							{
							if(a.price < b.price)
								return 1;
							if(a.price > b.price)
							    return -1;
							return 0
							}
							this.lesson.sort(descendPrice);
						}
						else if(this.attribute === "Subject")
						{
							function descendSubject(a,b)
							{
							if(a.subject < b.subject)
								return 1;
							if(a.subject > b.subject)
							    return -1;
							return 0
							}
							this.lesson.sort(descendSubject);
						}
						else if(this.attribute === "Location")
						{
							function descendLocation(a,b)
							{
							if(a.location < b.location)
								return 1;
							if(a.location > b.location)
							    return -1;
							return 0
							}
							this.lesson.sort(descendLocation);
						}
						else if(this.attribute === "Spaces")
						{ 
							function descendSpaces(a,b)
							{
							if(a.availableSpaces < b.availableSpaces)
								return 1;
							if(a.availableSpaces > b.availableSpaces)
							    return -1;
							return 0
							}
							this.lesson.sort(descendSpaces);
						}
						else
						{
							alert("Please choose an attribute");
						}
                    }

                },
                computed:{
                    cartItemCount: function()
                    {
                        return this.cart.length;
                    },
                    itemsInCart()  //checks if the items are present or not
                    {
                        return this.cartItemCount > 0;
                    },
                    canConfirmOrder()  
                    {  
                        let alphabets = /^[A-Za-z]+$/;
                        let num_range = /^[0-9]+$/;
                        return alphabets.test(this.order.firstName) && alphabets.test(this.order.lastName) && num_range.test(this.order.phoneNum);
                    }
                },
            });
        </script>
    </body>
</html>